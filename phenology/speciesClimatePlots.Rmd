---
title: "species responses"
author: "Richard J. Telford"
date: "January 25, 2017"
output: html_document
---

```{r setup, include=FALSE, echo = FALSE, cache = FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, message = FALSE, warning = FALSE, fig.height = 5.4, fig.width = 8)
knitr::read_chunk("weather_plots_newData.R")
knitr::read_chunk("phenology.R")
```

## Climate change

```{r loadWeather, include = FALSE}

```
```{r loadPhenology, cache = TRUE}
```
  
```{r theme}
#sets global theme for figures
th <- theme_bw(base_size = 11)
```

```{r Allium_ursinum, fig.keep = "none"}
```

```{r, cache = TRUE}
for(i in sort(unique(phenology2$species))){
  p <- pheno_plot %+% filter(phenology2, species == i, stage < 6) + ggtitle(i)
  print(p)
}
```
## Date of first flowering

```{r first_flowering, include = FALSE}
```



## Correlation of first flowering with temperature

```{r mergeClimateCorrelate}
```


## Regression of first flowering against March temperature



## Can phenological change keep up with climate?
```{r keepingUp1, fig.keep="none"}
```
  
```{r seasonalVelocity, fig.keep = "none"}
```
  
```{r keepingUp2, fig.keep="none"}
```



```{r}
for( i in unique(firstflowerReg$species)){
  dat <- filter(firstflowerReg, species == i) %>% 
       mutate(month2 = case_when(transect == "t36" ~ month2 - 3,
                                 transect == "t37" ~ month2 - 1,
                                 transect == "t38" ~ month2 + 1,
                                 transect == "t39" ~ month2 + 3))
  
  g3 <- g2 %+% dat
  h2 <- h %+% filter(first_flowering, species == i) + ggtitle(i) 
  
  cowplot::plot_grid(h2, g3,  nrow = 2, align = "v", rel_heights = c(1/3, 2/3)) %>% print()
}
```

